image: Visual Studio 2017
platform: Any CPU
configuration: Release
clone_depth: 5

environment:
  COVERALLS_TOKEN:
    secure: anxbSCDlPmPM4yWn1LKFlXuXaTS4VX4gkby2vyjaK5xFemjhMgttyMmtwcIncFyg

install:
  - ps: .\Install-Phase.ps1

before_build:
  - cmd: nuget restore .\DryIoc.Wcf.sln -Verbosity detailed

build:
  parallel: false
  project: .\DryIoc.Wcf.sln
  verbosity: detailed

test_script:
  - ps: .\run-tests.ps1

after_test:
  - cmd: packages\coveralls.io.1.4.2\tools\coveralls.net.exe --opencover coverage.xml -r %COVERALLS_TOKEN%

cache:
  - packages -> **\packages.config

artifacts:
  - path: '.\DryIoc.Wcf\bin\Release\DryIoc.Wcf.dll.*.nupkg'
    name: nuget
    type: NuGetPackage

deploy:
  - provider: NuGet
    api_key:
      secure: LKL3BM5Iphp+fjoZzhqLAMrQOLrNXvY4tEEa5zRKpTY2Ti4gOzBUhxaprnCzfTO3
    skip_symbols: false,
    artifact: /.*\.nupkg/
    on:
      DeployArtifacts: true
  - provider: GitHub
    description: 'Release'
    release: $(ReleaseVersion)
    auth_token:
      secure: K71ovddtT7BuOR1D1K9uVRdOT2+Apl6GdQjBYjUki/ySUX9EcWb2MNtupx5ymrkt
    artifact: /.*\.nupkg/
    on:
      DeployArtifacts: true 